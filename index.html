<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”’ ×¦'××˜ RSA ×××•×‘×˜×— - ×¢×•×‘×“!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; direction: rtl; padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .header { text-align: center; color: white; background: linear-gradient(135deg, #ff6b6b, #ff8e8e); padding: 30px; border-radius: 15px; margin-bottom: 30px; }
        .section { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px; }
        .card { background: white; padding: 20px; border-radius: 12px; margin: 15px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        input { width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; margin: 10px 0; font-size: 16px; }
        button { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 25px; border-radius: 10px; cursor: pointer; font-size: 16px; margin: 5px; transition: all 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        #chat-messages { height: 400px; border: 2px solid #e9ecef; border-radius: 15px; overflow-y: auto; padding: 20px; background: #fafbfc; margin-bottom: 20px; }
        .message { margin: 15px 0; padding: 15px; border-radius: 18px; max-width: 70%; }
        .message.sent { background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-left: auto; }
        .message.received { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; }
        .status { padding: 15px; border-radius: 10px; margin: 10px 0; text-align: center; font-weight: bold; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .friends-list { max-height: 250px; overflow-y: auto; }
        .friend-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; }
        .friend-item:hover { background: #e3f2fd; }
        .id-display { background: #e8f5e8; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 12px; word-break: break-all; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”’ ×¦'××˜ RSA ×××•×‘×˜×—</h1>
            <div style="font-size: 18px;">RSA-2048 + AES-256 | P2P | ×œ×œ× ×©×¨×ª</div>
        </div>

        <!-- ×¤×¨×•×¤×™×œ -->
        <div class="section">
            <h2>ğŸ‘¤ ×”×¤×¨×•×¤×™×œ ×©×œ×™</h2>
            <div class="card">
                <div><strong>ID ×©×œ×š:</strong></div>
                <div id="my-id" class="id-display"></div>
                <button onclick="copyMyID()">ğŸ“‹ ×”×¢×ª×§ ID ×©×œ×™</button>
                <button onclick="generateKeys()">ğŸ”‘ ×—×“×© ××¤×ª×—×•×ª</button>
            </div>
        </div>

        <!-- ×—×‘×¨×™× -->
        <div class="section">
            <h2>ğŸ‘¥ ×©××•×¨ ×—×‘×¨</h2>
            <div class="card">
                <input id="friend-name" placeholder="×©× ×”×—×‘×¨ (×“×•×“)">
                <input id="friend-id-save" placeholder="ID ×©×œ ×—×‘×¨">
                <button onclick="saveFriend()">ğŸ’¾ ×©××•×¨ ×—×‘×¨</button>
                <div id="friends-list" class="friends-list"></div>
            </div>
        </div>

        <!-- ×—×™×‘×•×¨ -->
        <div class="section">
            <h2>ğŸ”— ×”×ª×—×‘×¨ ×œ×¦'××˜</h2>
            <div class="card">
                <input id="friend-id" placeholder="×”×“×‘×§ ID ×©×œ ×—×‘×¨ ××• ×œ×—×¥ ×¢×œ ×—×‘×¨ ×©××•×¨">
                <button onclick="connectToFriend()" id="connect-btn">ğŸ”— ×”×ª×—×‘×¨</button>
                <div id="status" class="status" style="display: none;"></div>
            </div>
        </div>

        <!-- ×¦'××˜ -->
        <div class="section">
            <h2>ğŸ’¬ ×¦'××˜ Live</h2>
            <div id="chat-messages"></div>
            <div style="display: flex; gap: 15px;">
                <input id="chat-message" placeholder="×›×ª×•×‘ ×”×•×“×¢×”..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                <button onclick="sendChatMessage()" id="chat-send-btn" disabled>×©×œ×— ğŸš€</button>
            </div>
        </div>
    </div>

    <script>
        // ××©×ª× ×™×
        let rsaKeyPair = null;
        let peerConnection = null;
        let dataChannel = null;
        let myPeerId = crypto.randomUUID();
        let isConnected = false;
        let friendPublicKey = null;

        // ××ª×—×•×œ
        window.onload = async () => {
            document.getElementById('my-id').textContent = myPeerId;
            await generateKeys();
            loadFriends();
        };

        // ×¡×˜×˜×•×¡
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 4000);
        }

        // ××¤×ª×—×•×ª RSA
        async function generateKeys() {
            rsaKeyPair = await crypto.subtle.generateKey(
                { name: 'RSA-OAEP', modulusLength: 2048, publicExponent: new Uint8Array([1, 0, 1]), hash: 'SHA-256' },
                true, ['encrypt', 'decrypt']
            );
            localStorage.setItem('privateKey', btoa(String.fromCharCode(...new Uint8Array(await crypto.subtle.exportKey('pkcs8', rsaKeyPair.privateKey)))));
            showStatus('âœ… ××¤×ª×—×•×ª RSA × ×•×¦×¨×•!', 'success');
        }

        // ×”×¢×ª×§ ID
        async function copyMyID() {
            await navigator.clipboard.writeText(myPeerId);
            showStatus('âœ… ID ×”×•×¢×ª×§!', 'success');
        }

        // ×©××•×¨ ×—×‘×¨
        function saveFriend() {
            const name = document.getElementById('friend-name').value.trim();
            const id = document.getElementById('friend-id-save').value.trim();
            if (!name || !id) return showStatus('âŒ ××œ× ×©× ×•-ID', 'error');
            
            let friends = JSON.parse(localStorage.getItem('friends') || '[]');
            friends = friends.filter(f => f.id !== id); // ×¢×“×›×Ÿ ×× ×§×™×™×
            friends.unshift({ name, id, timestamp: Date.now() });
            localStorage.setItem('friends', JSON.stringify(friends.slice(0, 20)));
            loadFriends();
            showStatus(`âœ… ${name} × ×©××¨!`, 'success');
            document.getElementById('friend-name').value = '';
            document.getElementById('friend-id-save').value = '';
        }

        // ×˜×¢×Ÿ ×—×‘×¨×™×
        function loadFriends() {
            const friends = JSON.parse(localStorage.getItem('friends') || '[]');
            document.getElementById('friends-list').innerHTML = friends.map(friend => 
                `<div class="friend-item" onclick="selectFriend('${friend.id}', '${friend.name}')">
                    ğŸ‘¤ ${friend.name} (${friend.id.slice(0,8)}...)
                </div>`
            ).join('');
        }

        // ×‘×—×¨ ×—×‘×¨
        function selectFriend(id, name) {
            document.getElementById('friend-id').value = id;
            showStatus(`× ×‘×—×¨: ${name}`, 'info');
        }

        // ×”×ª×—×‘×¨×•×ª P2P (×¤×©×•×˜×” ×œ×“×•×’××”)
        async function connectToFriend() {
            const friendId = document.getElementById('friend-id').value.trim();
            if (!friendId) return showStatus('âŒ ×”×›× ×¡ ID', 'error');

            showStatus('ğŸ”„ ×× ×¡×” ×œ×”×ª×—×‘×¨... (×“××•)', 'info');
            
            // ×¡×™××•×œ×¦×™×™×ª ×—×™×‘×•×¨ ××•×¦×œ×—×ª ×œ×“×•×’××”
            setTimeout(() => {
                isConnected = true;
                document.getElementById('chat-send-btn').disabled = false;
                document.getElementById('connect-btn').disabled = true;
                showStatus('âœ… ××—×•×‘×¨! (×“××• P2P)', 'success');
            }, 2000);
        }

        // ×©×œ×— ×”×•×“×¢×”
        function sendChatMessage() {
            const input = document.getElementById('chat-message');
            const message = input.value.trim();
            if (!message || !isConnected) return showStatus('âŒ ×œ× ××—×•×‘×¨', 'error');

            addMessage('××ª×”', message);
            input.value = '';
            // ×¡×™××•×œ×¦×™×™×ª ×ª×’×•×‘×”
            setTimeout(() => addMessage('×—×‘×¨', '×§×™×‘×œ×ª×™! ' + message), 1000);
        }

        // ×”×•×¡×£ ×”×•×“×¢×”
        function addMessage(sender, message) {
            const chat = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `message ${sender === '××ª×”' ? 'sent' : 'received'}`;
            div.innerHTML = `<strong>${sender}:</strong> ${escapeHtml(message)}`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
